name: compileAPKIPA

on:
  pull_request:
    types:
      - opened
      - synchronize

jobs:
  compile_IPA_APK:
    runs-on: macos-14


    steps:
    - name: Checkout code with submodules
      uses: actions/checkout@v4
      with:
        submodules: 'recursive'

    - name: Read app version from YAML
      run: |
        APP_VERSION=$(sed -n 's/^version:[ ]*//p' pubspec.yaml | tr -d '[:space:]')
        echo "APP_VERSION=$APP_VERSION" >> $GITHUB_ENV
      
    - name: Set up Flutter
      uses: subosito/flutter-action@v2
      with:
        channel: stable
        flutter-version: 3.7.12
    - uses: oberhauser-dev/flutter-release-action@v0
      with:
        token: ${{ github.token }}
        dry-run: true
        app-name: 'moonchain_app'
        app-version: ${{ env.APP_VERSION }}
        tag: ${{ github.ref }}
        build-type: 'apk'
        build-args: |-
            --flavor product
            --release
